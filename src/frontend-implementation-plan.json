{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Fix anonymous LOC invoice delete/cancel UX and SOC/Discharge date rendering",
  "requirements": [
    {
      "id": "REQ-89",
      "summary": "Ensure LOC invoice delete/cancel works for anonymous users and the LOC receivables grid updates immediately after deletion.",
      "acceptanceCriteria": [
        "When not signed in, a user can delete LOC invoices returned by getLOCReceivables() from the LOC Receivables page using the Delete button without any sign-in prompt or authorization trap.",
        "When not signed in, a user can delete a LOC invoice from within the \"Claim details\" popup by clicking the button labeled exactly \"Cancel Invoice\" without any sign-in prompt or authorization trap.",
        "After a successful delete (bulk delete or Cancel Invoice), the deleted invoice(s) are removed from the LOC Receivables grid immediately (no manual refresh required).",
        "Deleting a LOC sample invoice restores the LOC sample inquiry availability so that clicking Display on the Manifest LOC Billing page can show the LOC inquiry again afterward (as per the existing LOC sample availability lifecycle).",
        "If a delete fails for a non-auth reason, the UI shows a clear English error message and remains usable (no stuck loading state)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useLocInvoiceReceivables.ts",
          "operation": "modify",
          "description": "Make LOC delete/cancel mutations explicitly use an anonymous backend actor (independent of Internet Identity state) to avoid any sign-in prompts for the LOC sample flow; on success, update the LOC receivables cache immediately and also invalidate the LOC inquiry query key so the sample inquiry can reappear after deletion. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/LocInvoiceReceivable.tsx",
          "operation": "modify",
          "description": "Harden delete/cancel UI behavior: ensure errors are shown as clear English messages (using existing normalization) and that dialog/grid state never gets stuck in a loading state on failure; keep the deleted invoices removed from the table via existing optimistic/cache updates and ensure selection is cleared/updated appropriately. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/utils/authErrorMessages.ts",
          "operation": "modify",
          "description": "Adjust authorization-related messaging for the LOC delete/cancel flow so anonymous LOC deletions do not surface a misleading sign-in instruction; preserve clear English errors for genuine non-auth failures while keeping UI usable. Verify the component's usage instructions before implementing."
        }
      ]
    },
    {
      "id": "REQ-90",
      "summary": "Display SOC Date as 1/1/2026 and Discharge Date as blank for the LOC sample inquiry, and ensure invoices created from that inquiry store those normalized values.",
      "acceptanceCriteria": [
        "On the Manifest LOC Billing page, after clicking Display, the Status column shows SOC Date exactly \"1/1/2026\" for the PhilipTest row.",
        "On the Manifest LOC Billing page, after clicking Display, the Status column shows Discharge Date as blank/empty for the PhilipTest row (no date text is rendered).",
        "When creating an invoice from the displayed LOC inquiry, the invoice stores the SOC Date value as \"1/1/2026\" and stores Discharge Date as empty (null/undefined/empty string), and the LOC Receivables \"Claim details\" popup displays SOC Date as \"1/1/2026\" (and does not display any discharge date value).",
        "The backend LOC sample invoice detection logic (used to allow anonymous behavior and to toggle sample availability) remains consistent with the updated SOC/Discharge date values, so LOC creation/deletion rules still apply to the sample invoice."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/ManifestLocBilling.tsx",
          "operation": "modify",
          "description": "Normalize the displayed LOC inquiry values for the sample row (PhilipTest): force SOC Date to \"1/1/2026\" and ensure Discharge Date is treated as empty; render Discharge Date as blank (no date text) in the Status column; when creating an invoice from the inquiry, pass the normalized SOC/Discharge values so stored invoice data matches the UI. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/pages/LocInvoiceReceivable.tsx",
          "operation": "modify",
          "description": "Ensure the \"Claim details\" dialog receives and displays SOC Date consistently for LOC invoices created from the sample inquiry (expecting \"1/1/2026\"), and that no discharge date value is introduced/presented in this flow. Verify the component's usage instructions before implementing."
        }
      ]
    }
  ]
}